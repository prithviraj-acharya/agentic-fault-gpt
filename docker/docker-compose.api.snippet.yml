# Compose snippet (merge into your existing docker-compose file)
# Assumes your Kafka service is named `kafka` and exposes listener `kafka:29092`.

services:
  dashboard-api:
    build:
      context: ..
      dockerfile: Dockerfile.api
    ports:
      - "8000:8000"
    volumes:
      # Store SQLite DB on a Docker-managed volume (Linux filesystem).
      - tickets_db:/data
    environment:
      KAFKA_BOOTSTRAP_SERVERS: "kafka:29092"
      KAFKA_TELEMETRY_TOPICS: "ahu.telemetry"
      KAFKA_WINDOW_TOPICS: "window_summaries"
      KAFKA_AUTO_OFFSET_RESET: "latest"
      KAFKA_CONSUMER_GROUP_PREFIX: "dashboard-api"
      KAFKA_REPLAY_ON_STARTUP: "0"
      # Tickets DB (written by diagnostic_agent, read/updated by dashboard-api for review fields only)
      TICKETS_DB_PATH: "/data/tickets.db"
      # Use WAL on Linux volume for better concurrency.
      TICKETS_SQLITE_JOURNAL_MODE: "WAL"
      TELEMETRY_RETENTION_MINS: "30"
      WINDOWS_MAXLEN: "500"
      ONLINE_THRESHOLD_SECS: "15"
      MAX_POINTS: "2000"
      MAX_MINS: "120"
      MAX_LIMIT: "200"
      LOG_LEVEL: "INFO"
      CORS_ORIGINS: "*"
    depends_on:
      - kafka

volumes:
  tickets_db:
